@using Newtonsoft.Json;
@inject IHttpContextAccessor HttpContextAccessor
@{
    Layout = "_Layout_main";
}
@{
    var permissions = new List<KeyValuePair<string, string>>();

    // استرجاع الصلاحيات من الجلسة إذا كانت موجودة
    var permissionsJson = HttpContextAccessor.HttpContext.Session.GetString("UserPermissions");

    if (!string.IsNullOrEmpty(permissionsJson))
    {
        permissions = JsonConvert.DeserializeObject<List<KeyValuePair<string, string>>>(permissionsJson);
    }

    // التحقق من وجود صلاحيات معينة
    bool canRole = permissions.Any(c => c.Key == "Permission" && c.Value == "Permissions.Role.View");
    bool canEdit = permissions.Any(c => c.Key == "Permission" && c.Value == "Permissions.StaffManagement.Edit");
    bool canDelete = permissions.Any(c => c.Key == "Permission" && c.Value == "Permissions.StaffManagement.Delete");
}
<div class="container-fluid">
    <div class="row">
        <div class="col-lg-12 pt-3">
            <header class="header-filter">
                <div class="group-filter d-flex">
                    <div class="input-group me-3">
                        <input id="txtSearch" class="form-control" type="search" placeholder="Search" aria-label="Recipient's username" aria-describedby="button-addon2">
                        <button class="btn btn-outline-master" id="button-addon2" type="button" onclick="DashboardSearch()"> <i class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                    <button class="btn btn-outline-master d-flex align-items-center" type="button" data-bs-toggle="modal" data-bs-target="#exampleModal"> <i class="fa-solid fa-arrow-down-wide-short me-2"></i>Filter</button>
                </div>
                <div class="date">
                    @ViewBag.DisplayCurrntDate
                </div>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle rounded-pill btn-master" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-plus me-2"></i> Create
                    </button>
                    <ul class="dropdown-menu bg-primary text-white">
                        @if (permissions != null && permissions.Any(c => c.Key == "Permission" && c.Value == "Permissions.CreateOrders.Create"))
                        {
                            <li><a class="dropdown-item text-white" asp-controller="CreateOrders" asp-action="Index"><i class="fa-solid fa-plus me-2"></i> Order</a></li>
                        }
                        @if (permissions != null && permissions.Any(c => c.Key == "Permission" && c.Value == "Permissions.InspectionOrder.Create"))
                        {
                            <li><a class="dropdown-item text-white" asp-controller="InspectionOrder" asp-action="InspectionOrder"><i class="fa-solid fa-plus me-2"></i> Room inspiction</a></li>
                        }
                    </ul>
                </div>
            </header>
        </div>
    </div>
</div>

<div class="time-management addTask-page" id="pageMasterLoad">
    <div class="container-fluid pt-3">
        <header class="header-filter align-items-end">
            <div class="group-filter d-flex">
                <div class="input-group me-3">
                    <input class="form-control" type="week" id="weekdata" onchange="getDataWeek()">
                    <button class="btn btn-outline-master" id="button-addon2" type="button"> <i class="fa-solid fa-calendar-days"></i></button>
                </div>
                <div class="input-group me-3">
                    @*<input class="form-control" type="search" placeholder="Search" aria-label="Recipient's username" aria-describedby="button-addon2">
                    <button class="btn btn-outline-master" id="button-addon2" type="button"> <i class="fa-solid fa-magnifying-glass"></i></button> *@
                </div>
            </div>
        </header>
        <div class="table-responsive-addTasks">
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th class="text-center align-middle">Employees</th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_0"></div>
                            <div class="date" id="Day_0"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_1"></div>
                            <div class="date" id="Day_1"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_2"></div>
                            <div class="date" id="Day_2"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_3"></div>
                            <div class="date" id="Day_3"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_4"></div>
                            <div class="date" id="Day_4"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_5"></div>
                            <div class="date" id="Day_5"></div>
                        </th>
                        <th class="text-center align-middle">
                            <div class="day" id="DayName_6"></div>
                            <div class="date" id="Day_6"></div>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <th>
                            <div class="name" id="empName">
                                Mohamed Alaa Said
                                <input type="hidden" id="hfEmpId" />
                            </div>
                            <div class="time" id="empTime">28/ 40 hrs</div>
                            <div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar" id="progEmp" style="width: 25%">25%</div>
                            </div>
                        </th>
                        <td>
                            <div class="add-task">
                                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#AddTask">Add Task</button>
                            </div>
                        </td>
                        <td>
                            <div class="holiday">
                                <h6>Weekend </h6>
                                <div class="footer-card">
                                    <div class="dropdown">
                                        <a class="btn btn-light dropdown-toggle btn-sm" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Edit</a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#ChangeVacation">Change vacation</a></li>
                                            <li><a class="dropdown-item" type="button" onclick="confirm('Do You Want To Cancel Vacation!')"> Cancel vacation</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="holiday sickLeave">
                                <h6>Sick Leave </h6>
                                <div class="footer-card">
                                    <div class="dropdown">
                                        <a class="btn btn-light dropdown-toggle btn-sm" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Edit</a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#ChangeVacation">Change vacation</a></li>
                                            <li><a class="dropdown-item" type="button" onclick="confirm('Do You Want To Cancel Vacation!')"> Cancel vacation</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="holiday Work-time">
                                <h6>08:05 - 16:00 => MS</h6>
                                <div class="hour-time">7 / 8 hrs</div>
                                <div class="progress" role="progressbar" aria-label="Basic example" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                                    <div class="progress-bar w-75"></div>
                                </div>
                                <div class="footer-card">
                                    <div class="dropdown">
                                        <a class="btn btn-light dropdown-toggle btn-sm" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">Edit</a>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#AddTask">Add Task</a></li>
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#ChangeEmployee">Change Employee</a></li>
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#ChangeShift">Change Shift</a></li>
                                            <li><a class="dropdown-item" type="button" data-bs-toggle="modal" data-bs-target="#moreInfo">More Info</a></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <div class="add-task">
                                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#AddTask">Add Task</button>
                            </div>
                        </td>
                        <td>
                            <div class="add-task">
                                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#AddTask">Add Task</button>
                            </div>
                        </td>
                        <td>
                            <div class="add-task">
                                <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#AddTask">Add Task</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <th>
                            <div class="name">Ahmed Ali Ayman</div>
                            <div class="time">38/ 40 hrs</div>
                            <div class="progress" role="progressbar" aria-label="Example with label" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100">
                                <div class="progress-bar bg-warning" style="width: 75%">75%</div>
                            </div>
                        </th>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="d-flex justify-content-end"><a class="btn btn-master rounded-pill w-25" href="TimeManagement.html">Save            </a></div>
        <div class="container-room"> </div>
    </div>
</div>
@* Modale start *@
<div class="modal fade" id="AddTask" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Add Task</h1>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label">Employee</label>
                    <input class="form-control" type="text" readonly id="txtEmpName">
                </div>
                <div class="mb-3">
                    <label class="form-label">Rooms</label>
                    <div class="input-group">
                        <select class="form-select" id="ddlRooms"></select>
                        <select class="form-select" id="ddlItems" style="display: none;"></select>
                        
                        <button class="input-group-text btn btn-outline-success" id="btnAddRooms">
                            <i class="fa-solid fa-plus"></i>
                        </button>
                    </div>
                </div>
                <table class="table table-bordered text-center">
                    <thead>
                        <tr>
                            <th>Room</th>
                            <th>Services</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="roomList">
                    </tbody>
                </table>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button" id="btnSaveTask">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ChangeEmployee" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Change Employee</h1>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="exampleInputEmail1">Select Employee</label>
                    <select class="form-select" aria-label="Default select example">
                        <option selected="">Open this select menu</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ChangeShift" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Change Shift</h1>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="exampleInputEmail1">Select Shift</label>
                    <select class="form-select" aria-label="Default select example">
                        <option selected="">Open this select menu</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="ChangeVacation" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Change Vacation</h1>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="exampleInputEmail1">Select Vacation</label>
                    <select class="form-select" aria-label="Default select example">
                        <option selected="">Open this select menu</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
                <button class="btn btn-primary" type="button">Save changes</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="moreInfo" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Mohamed Alaa Said  Info</h1>
                <button class="btn-close" type="button" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="home-tab" data-bs-toggle="tab" data-bs-target="#home-tab-pane" type="button" role="tab" aria-controls="home-tab-pane" aria-selected="true">Over View</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile-tab-pane" type="button" role="tab" aria-controls="profile-tab-pane" aria-selected="false">More Info</button>
                    </li>
                </ul>
                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="home-tab-pane" role="tabpanel" aria-labelledby="home-tab" tabindex="0">
                        <div id="chartOverView"></div>
                    </div>
                    <div class="tab-pane fade" id="profile-tab-pane" role="tabpanel" aria-labelledby="profile-tab" tabindex="0">
                        <table class="table table-striped table-bordered mt-2">
                            <thead>
                                <tr>
                                    <th>No. Task</th>
                                    <th>Room No.</th>
                                    <th>Type Room</th>
                                    <th>Credits</th>
                                    <th>Status</th>
                                    <th>Physical time Start </th>
                                    <th>Physical time End </th>
                                    <th>Time Difference</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>01</td>
                                    <td>Room 110</td>
                                    <td>Single</td>
                                    <td>2</td>
                                    <td>New</td>
                                    <td>00:00</td>
                                    <td>00:00</td>
                                    <td>00:00</td>
                                </tr>
                                <tr>
                                    <td>02</td>
                                    <td>Room 111</td>
                                    <td>Double</td>
                                    <td>5</td>
                                    <td>Closed</td>
                                    <td>09:30</td>
                                    <td>10:00</td>
                                    <td class="text-success">-00:05</td>
                                </tr>
                                <tr>
                                    <td>03</td>
                                    <td>Room 112</td>
                                    <td>Double</td>
                                    <td>3</td>
                                    <td>Active</td>
                                    <td>11:15</td>
                                    <td>00:00</td>
                                    <td>00:00</td>
                                </tr>
                                <tr>
                                    <td>04</td>
                                    <td>Room 113</td>
                                    <td>Double</td>
                                    <td>5</td>
                                    <td>Closed</td>
                                    <td>09:15</td>
                                    <td>09:30</td>
                                    <td>00:00</td>
                                </tr>
                                <tr>
                                    <td>05</td>
                                    <td>Room 115</td>
                                    <td>Single</td>
                                    <td>2</td>
                                    <td>Closed</td>
                                    <td>09:30</td>
                                    <td>10:00</td>
                                    <td class="text-danger">+00:15</td>
                                </tr>
                            </tbody>
                            <tfoot>
                                <tr>
                                    <th>Total</th>
                                    <td>10</td>
                                    <td> </td>
                                    <td>43</td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                    <td> </td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
@* Modale End *@

@section Scripts {
    <script>
        $(document).ready(function () {
            getDate();

            // تحميل البيانات عند فتح المودل
            $('#AddTask').on('show.bs.modal', function (event) {
                // الحصول على اسم الموظف وعرضه في المودل
                var employeeName = $(event.relatedTarget).closest('tr').find('.name').text();
                $('#txtEmpName').val(employeeName);

                // تحميل الغرف والأصناف
                loadRooms();
                loadItems();
            });

            // دالة لتحميل قائمة الغرف
            function loadRooms() {
                $('#ddlRooms').empty();
                $.ajax({
                    url: '/TimeManagement/getRooms',
                    type: 'GET',
                    success: function (data) {
                        if (data.success) {
                            data.rooms.forEach(function (room) {
                                $('#ddlRooms').append(`<option value="${room.id}">${room.name}</option>`);
                            });
                        }
                    }
                });
            }

            // دالة لتحميل قائمة الخدمات
            function loadItems() {
                $('#ddlItems').empty();
                $.ajax({
                    url: '/TimeManagement/getServices',
                    type: 'GET',
                    success: function (data) {

                        if (data.success) {
                            data.services.forEach(function (service) {
                                $('#ddlItems').append(`<option value="${service.id}">${service.name}</option>`);
                            });
                        }
                    }
                });
            }

            // // إضافة الغرفة إلى القائمة
            // $('#btnAddRooms').on('click', function () {
            //     var roomId = $('#ddlRooms').val();
            //     var roomName = $('#ddlRooms option:selected').text();

            //     var row = `<tr data-roomid="${roomId}">
            //                             <td class="align-middle">${roomName}</td>
            //                             <td class="align-middle">
            //                                 <select class="form-select serviceSelect">
            //                                     ${$('#ddlItems').html()}
            //                                 </select>
            //                             </td>
            //                             <td class="align-middle">
            //                                 <a href="#" class="js-itemDelete"><i class="fa-solid fa-trash-can text-danger"></i></a>
            //                             </td>
            //                        </tr>`;
            //     $('#roomList').append(row);
            // });

            // إضافة غرفة جديدة إلى القائمة
            $('#btnAddRooms').on('click', function () {
                var selectedRoomId = $('#ddlRooms').val();
                var selectedRoomText = $('#ddlRooms option:selected').text();
                var itemOptions = $('#ddlItems').html();

                // إضافة سطر جديد في الجدول للغرفة
                $('#roomList').append(`
                <tr data-room-id="${selectedRoomId}">
                    <td class="align-middle">${selectedRoomText}</td>
                    <td class="align-middle">
                        <select class="form-select">${itemOptions}</select>
                    </td>
                    <td class="align-middle">
                        <button type="button" class="btn btn-danger btn-sm btnDeleteRoom"><i class="fa-solid fa-trash-can"></i></button>
                    </td>
                </tr>
                `);
            });

            // حذف الغرفة من القائمة
            $(document).on('click', '.btnDeleteRoom', function () {
                $(this).closest('tr').remove();
            });
            // // حذف الغرفة من القائمة
            // $('#roomList').on('click', '.js-itemDelete', function (e) {
            //     e.preventDefault();
            //     $(this).closest('tr').remove();
            // });

            // // حفظ البيانات في الباك اند
            // $('#btnSaveTask').on('click', function () {
            //     var roomData = [];
            //     $('#roomList tr').each(function () {
            //         var roomId = $(this).data('roomid');
            //         var serviceId = $(this).find('.serviceSelect').val();
            //         roomData.push({ roomId: roomId, serviceId: serviceId });
            //     });

            //     $.ajax({
            //         url: '/TimeManagement/saveTask',
            //         type: 'POST',
            //         contentType: 'application/json',
            //         data: JSON.stringify(roomData),
            //         success: function (response) {
            //             // تنفيذ ما تريده عند نجاح الحفظ
            //             $('#AddTask').modal('hide');
            //             alert('تم الحفظ بنجاح');
            //         },
            //         error: function (error) {
            //             // التعامل مع الخطأ
            //             alert('حدث خطأ أثناء الحفظ');
            //         }
            //     });
            // });
            
            // حفظ البيانات وإرسالها إلى الباكند
            $('#btnSaveTask').on('click', function () {
                var taskList = [];
                $('#roomList tr').each(function () {
                    var roomId = $(this).data('room-id'); // استخراج ID الغرفة
                    var roomName = $(this).find('td:eq(0)').text();
                    var itemId = $(this).find('select').val();
                    taskList.push({ roomId: roomId,roomName: roomName, itemId: itemId });
                });

                // إرسال البيانات للباكند
                $.ajax({
                    url: '/TimeManagement/saveTask', // تعديل URL ليتوافق مع الـ API المناسب
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(taskList),
                    success: function () {
                        alert('تم حفظ البيانات بنجاح');
                        $('#AddTask').modal('hide');
                    },
                    error: function () {
                        alert('حدث خطأ أثناء الحفظ');
                    }
                });
            });
        });

        //
        function getDate() {
            // الحصول على التاريخ الحالي
            var today = new Date();
            console.log('Today:', today);

            // التحقق مما إذا كان اليوم هو يوم الأحد
            var dayOfWeek = today.getDay();
            var referenceSunday;

            if (dayOfWeek === 0) {
                // إذا كان اليوم هو الأحد، نستخدمه كنقطة البداية
                referenceSunday = new Date(today);
            } else {
                // إذا لم يكن الأحد، نحسب أقرب أحد قادم
                var daysToNextSunday = 7 - dayOfWeek;
                referenceSunday = new Date(today);
                referenceSunday.setDate(today.getDate() + daysToNextSunday);
            }

            console.log('Reference Sunday:', referenceSunday);

            // حساب الفرق بين اليوم والأحد المرجعي
            var daysDifference = (referenceSunday - today) / (1000 * 60 * 60 * 24);
            console.log('Days Difference:', daysDifference);

            // تحديد السنة ورقم الأسبوع
            var year;
            var weekNumber;

            if (daysDifference > 6) {
                // إذا كان الفرق أقل من أو يساوي 6 أيام، استخدم الأسبوع الحالي
                year = today.getFullYear();
                weekNumber = getWeekNumber(today);
            } else {
                // إذا كان الفرق أكثر من 6 أيام، استخدم الأسبوع التالي
                year = referenceSunday.getFullYear();
                weekNumber = getWeekNumber(referenceSunday);

            }
            //console.log('1year: ' + year);
            // console.log('1referenceSunday: ' + referenceSunday);
            // console.log('1weekNumber: ' + weekNumber);
            // صيغة yyyy-Wxx
            var formattedWeek = `${year}-W${(weekNumber < 10 ? '0' : '') + weekNumber}`;
            //console.log('Formatted Week:', formattedWeek);

            // تعيين القيمة الافتراضية لحقل input
            $('#weekdata').val(formattedWeek);
            getDataWeek();
        }

        // دالة لحساب رقم الأسبوع حسب نظام ISO
        function getWeekNumber(date) {
            // إنشاء نسخة من التاريخ المدخل للتأكد من عدم التعديل في الأصل
            var targetDate = new Date(date.getTime());
            targetDate.setHours(0, 0, 0, 0);

            // الحصول على أول يوم في السنة
            var startOfYear = new Date(targetDate.getFullYear(), 0, 1);
            startOfYear.setHours(0, 0, 0, 0);

            // العثور على أول أحد في السنة
            while (startOfYear.getDay() !== 0) {
                startOfYear.setDate(startOfYear.getDate() + 1);
            }

            // حساب الفرق بين التاريخ المدخل وأول أحد في السنة (بالأيام)
            var daysDifference = Math.floor((targetDate - startOfYear) / (1000 * 60 * 60 * 24));

            // حساب رقم الأسبوع
            return Math.floor(daysDifference / 7) + 1;
        }
        function getDataWeek() {

            const weekInput = $('#weekdata').val();
            console.log('Selected Week Input:', weekInput);

            if (weekInput) {
                // استخراج السنة ورقم الأسبوع من إدخال المستخدم
                const [year, week] = weekInput.split("-W").map(Number);
                console.log('Year:', year, 'Week:', week);

                // تعيين بداية السنة
                const firstDayOfYear = new Date(year, 0, 1);

                // العثور على أول يوم أحد من السنة
                const firstSundayOfYear = new Date(firstDayOfYear);
                firstSundayOfYear.setDate(firstSundayOfYear.getDate() + (7 - firstSundayOfYear.getDay()) % 7);

                // حساب أول يوم أحد للأسبوع المطلوب
                const firstDayOfWeek = new Date(firstSundayOfYear);
                firstDayOfWeek.setDate(firstSundayOfYear.getDate() + (week - 1) * 7);

                const daysOfWeek = [];

                // الحصول على تواريخ الأيام من الأحد إلى السبت مع اسم اليوم
                for (let i = 0; i < 7; i++) {
                    const day = new Date(firstDayOfWeek);
                    day.setDate(firstDayOfWeek.getDate() + i);

                    const formattedDate = day.toISOString().slice(0, 10); // التنسيق: yyyy-mm-dd
                    const dayName = day.toLocaleDateString('en-US', { weekday: 'long' }); // استخراج اسم اليوم بالعربية

                    daysOfWeek.push({ date: formattedDate, name: dayName });
                }

                // تحديث التواريخ وأسماء الأيام في الجدول
                daysOfWeek.forEach((dayInfo, index) => {
                    $(`#Day_${index}`).text(dayInfo.date);      // طباعة التاريخ
                    $(`#DayName_${index}`).text(dayInfo.name);  // طباعة اسم اليوم
                });

                console.log("تواريخ أيام الأسبوع:", daysOfWeek);
                getDatafromTable(daysOfWeek);

            } else {
                console.log("لم يتم اختيار أسبوع.");
            }
        }
        function getDatafromTable(data) {

            $.ajax({
                url: '@Url.Action("getDataWeek", "TimeManagement")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                Cache: false,
                success: function (result) {
                    if (result.success) {


                    } else {
                        alert(result.message);
                    }
                },
                error: function (err) {
                    return false;
                }
            });
        }

        //Modale Add Task function//

        function addroomtolist(element) {

        }
        //End Modale Add Task function//


    </script>
}